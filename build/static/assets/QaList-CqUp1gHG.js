import{M as ge}from"./MultiFileInput-BQrdZzvc.js";import{g as ye}from"./table-B8sZ3RHj.js";import{x,I as Ee,y as V,d as q,r as p,c as E,s as Ie,a as I,g as t,b as S,j as f,h as s,f as d,O as ke,P as we,Q as Ce,A as xe,o as v,F as T,G,B,u as O,t as K,E as U,M as Ve,z as he}from"./index-COYtomWE.js";import{a as Fe,b as De,g as Ae,d as Se}from"./utils-6PSWH6Jr.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={classification:"类别",name:"量表名称",applicableAge:"适用年龄"},P=["classification","name","applicableAge"],g="whsg/inventories",Te={id:"",name:"",classification:"",applicableAge:"",files:[]};function C(){const a=De(),u=Ee(Te);return u.id=a,u}function Be(a){const u=C(),o=Object.assign(u,a),r=x(g);let i=[];return r?i=r.concat(o):i=[o],V(g,i)}function Oe(a){return V(g,a)}function j(a,u){const o=x(g);if(!a)return o||[];if(o){let r=o;return a&&(r=r.filter(i=>Fe(i).some(c=>typeof i[c]=="string"&&i[c]?i[c].includes(a)||a.includes(i[c]):!1))),r}else return[]}function Ue(a){const u=x(g);if(u){const o=u.filter(r=>r.id!==a);V(g,o)}}const je={class:"inventories-table"},Le={class:"dlg-body"},Re={class:"top"},$e={class:"table"};function Me(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!Ve(a)}const L="whsg/stash/input-inventory",Ne=q({__name:"InventoryTable",setup(a){const u=p(j()),o=p(!1),r=p([]),i=p([]),c=p([]),h=E(()=>i.value.filter(e=>c.value.includes(e.filename))),R=E({get(){return i.value.length===h.value.length},set(e){e?c.value=i.value.map(l=>l.filename):c.value=[]}}),b=p(!1),Y=E(()=>o.value?"上传文件":"下载文件"),J=E(()=>o.value?"确认操作":"确认下载"),F=p(""),W=E(()=>o.value?!r.value.length:!h.value.length),$=p([]);function X(e){$.value=e.files.slice()}function Z(e){window.open(`/preview?filename=${encodeURIComponent(e)}&type=${Ae(e)}`)}function ee(e){F.value=e.id,o.value=!0,b.value=!0,r.value=e.files.map(l=>({...l}))}function le(e){F.value=e.id,o.value=!1,b.value=!0,i.value=e.files.map(l=>({...l}))}function te(){b.value=!1}function ne(){if(o.value){const e=u.value.find(l=>l.id===F.value);e&&(e.files=r.value,Oe(u.value))}else h.value.forEach(e=>{Se(`/api/files/download/${e.filename}`,e.name)});b.value=!1}const ae=ye({keys:P.slice(),width:e=>e==="name"?400:250,titleObj:Q,renderer(){}},{key:"indexor",title:"序号",width:100,cellRenderer({rowIndex:e}){return t("span",null,[e+1])}},{key:"operator",title:"操作",width:260,cellRenderer({rowData:e}){return t("div",{class:"operators"},[t("span",{class:`gap-12 text-primary text-hoverable-primary clickable${e.files.length?"":" text-disabled"}`,onClick:()=>le(e)},[d("下载")]),t("span",{class:"gap-12 text-primary text-hoverable-primary clickable",onClick:()=>ee(e)},[d("上传")]),t(ke,{trigger:"click",onCommand:Z},{default:()=>t("span",{class:`gap-12 text-primary text-hoverable-primary clickable${e.files.length?"":" text-disabled"}`,onClick:()=>X(e)},[d("预览")]),dropdown:()=>{let l;return t(we,null,Me(l=$.value.map(y=>t(Ce,{command:y.filename},{default:()=>[y.name]})))?l:{default:()=>[l]})}}),t("span",{class:"gap-12 text-primary text-hoverable-primary clickable",onClick:()=>pe(e)},[d("删除")])])}}),k=p(!1),m=p(C());function oe(){k.value=!0;const e=x(L);e?m.value=e:m.value=C()}function M(){k.value=!1}function se(){m.value=C()}function ue(){se(),M()}function ie(){he(L)}function re(){V(L,m.value,"json")===0&&U.success("暂存成功")}function de(){Be(m.value)===0?(U({message:"录入成功",type:"success"}),M(),ie()):U({message:"录入失败",type:"error"}),u.value=j()}const D=p(""),ce=Ie(e=>{u.value=j(e)}),w=()=>{ce(D.value)};async function pe(e){await xe.confirm("确定要删除该量表吗？","量表删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),Ue(e.id),w()}return(e,l)=>{const y=f("ElInput"),fe=f("ElFormItem"),me=f("ElForm"),_=f("ElButton"),N=f("ElDialog"),z=f("ElCheckbox"),ve=f("ElCheckboxGroup"),_e=f("ElTableV2"),be=f("ElAutoResizer");return v(),I("div",je,[t(N,{modelValue:k.value,"onUpdate:modelValue":l[0]||(l[0]=n=>k.value=n),title:"录入信息","close-on-click-modal":!1},{footer:s(()=>[t(_,{class:"opt-btn",onClick:ue},{default:s(()=>l[6]||(l[6]=[d("放弃",-1)])),_:1,__:[6]}),t(_,{type:"warning",class:"opt-btn",onClick:re},{default:s(()=>l[7]||(l[7]=[d("暂存",-1)])),_:1,__:[7]}),t(_,{type:"primary",class:"opt-btn",onClick:de},{default:s(()=>l[8]||(l[8]=[d("提交",-1)])),_:1,__:[8]})]),default:s(()=>[S("div",Le,[t(me,{model:m.value,"label-width":"auto"},{default:s(()=>[(v(!0),I(T,null,G(O(P),n=>(v(),B(fe,{label:O(Q)[n],key:n},{default:s(()=>[t(y,{modelValue:m.value[n],"onUpdate:modelValue":A=>m.value[n]=A},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["model"])])]),_:1},8,["modelValue"]),t(N,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=n=>b.value=n),title:Y.value,"close-on-click-modal":!1},{footer:s(()=>[t(_,{class:"opt-btn",onClick:te},{default:s(()=>l[10]||(l[10]=[d("放弃",-1)])),_:1,__:[10]}),t(_,{type:"primary",class:"opt-btn",disabled:W.value,onClick:ne},{default:s(()=>[d(K(J.value),1)]),_:1},8,["disabled"])]),default:s(()=>[o.value?(v(),B(ge,{key:0,files:r.value,"onUpdate:files":l[1]||(l[1]=n=>r.value=n),"input-mode":"","only-upload":""},null,8,["files"])):(v(),I(T,{key:1},[t(z,{modelValue:R.value,"onUpdate:modelValue":l[2]||(l[2]=n=>R.value=n)},{default:s(()=>l[9]||(l[9]=[d("全选",-1)])),_:1,__:[9]},8,["modelValue"]),t(ve,{class:"download-group",modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=n=>c.value=n)},{default:s(()=>[(v(!0),I(T,null,G(i.value,n=>(v(),B(z,{key:n.filename,value:n.filename,label:n.name},{default:s(()=>[d(K(n.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])],64))]),_:1},8,["modelValue","title"]),S("div",Re,[t(y,{modelValue:D.value,"onUpdate:modelValue":l[5]||(l[5]=n=>D.value=n),placeholder:"输入需要搜索的关键字",type:"search",onChange:w,onClear:w},{append:s(()=>[t(_,{class:"search-enter",onClick:w},{default:s(()=>l[11]||(l[11]=[d("搜索",-1)])),_:1,__:[11]})]),_:1},8,["modelValue"]),t(_,{class:"record-btn",type:"primary",onClick:oe},{default:s(()=>l[12]||(l[12]=[d("录入",-1)])),_:1,__:[12]})]),S("div",$e,[t(be,null,{default:s(({width:n,height:A})=>[t(_e,{class:"inventories-table__inner",columns:O(ae),data:u.value,width:n,height:A},null,8,["columns","data","width","height"])]),_:1})])])}}}),ze=H(Ne,[["__scopeId","data-v-ea4eb85b"]]),Ge={class:"card"},Ke=q({__name:"QaList",setup(a){return(u,o)=>(v(),I("div",Ge,[t(ze)]))}}),We=H(Ke,[["__scopeId","data-v-326e0b04"]]);export{We as default};
