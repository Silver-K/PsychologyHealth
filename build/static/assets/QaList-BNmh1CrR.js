import{M as _e}from"./MultiFileInput-BNB1gvTJ.js";import{g as be}from"./table-B8sZ3RHj.js";import{N as ge,J as V,d as Q,r as d,c as I,B as we,a as _,f as t,b as R,C as ke,h as c,g as o,m as u,Y as Ie,Z as Ce,_ as Ee,D as Ve,I as he,o as p,F as S,z as M,p as T,u as A,t as P,G as xe,E as O,W as Fe,H as De}from"./index-BQnCW9fW.js";import{a as Se,g as Te,d as Ae}from"./utils-DdpY_R0b.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={classification:"类别",name:"量表名称",applicableAge:"适用年龄"},G=["classification","name","applicableAge"],Oe={id:"",name:"",classification:"",applicableAge:"",files:[]};function E(){const s=Se(),n=ge(Oe);return n.id=s,n}async function Be(s){const n=E(),i=Object.assign(n,s),r=await V("/api/data/new-inventory",{method:"POST",data:i});return r&&r.status===200&&r.data&&r.data.success?0:1}async function Ue(s,n){const i=await V(`/api/data/edit-inventory?id=${s}`,{method:"POST",data:n});return i&&i.status===200&&i.data&&i.data.success?0:1}async function H(s,n){const i=await V("/api/data/get-inventory",{method:"POST",data:{searchVal:s,...n}});return i&&i.status===200&&i.data&&i.data.success?i.data.data:[]}async function $e(s){const n=await V(`/api/data/remove-inventory?id=${s}`,{method:"POST"});return n&&n.status===200&&n.data&&n.data.success?0:1}const Le={class:"inventories-table"},je={class:"dlg-body"},Ne={class:"top"},Re={key:0,class:"table"};function Me(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!Fe(s)}const B="whsg/stash/input-inventory",Pe=Q({__name:"InventoryTable",setup(s){const n=d();async function i(){n.value=await H()}i();const r=d(!1),b=d([]),g=d([]),w=d([]),h=I(()=>g.value.filter(e=>w.value.includes(e.filename))),U=I({get(){return g.value.length===h.value.length},set(e){e?w.value=g.value.map(a=>a.filename):w.value=[]}}),v=d(!1),J=I(()=>r.value?"上传文件":"下载文件"),K=I(()=>r.value?"确认操作":"确认下载"),x=d(""),W=I(()=>r.value?!b.value.length:!h.value.length),$=d([]);function Y(e){$.value=e.files.slice()}function Z(e){window.open(`/preview?filename=${encodeURIComponent(e)}&type=${Te(e)}`)}function X(e){x.value=e.id,r.value=!0,v.value=!0,b.value=e.files.map(a=>({...a}))}function ee(e){x.value=e.id,r.value=!1,v.value=!0,g.value=e.files.map(a=>({...a}))}function ae(){v.value=!1}const te=be({keys:G.slice(),width:e=>e==="name"?400:250,titleObj:z,renderer(){}},{key:"indexor",title:"序号",width:100,cellRenderer({rowIndex:e}){return t("span",null,[e+1])}},{key:"operator",title:"操作",width:260,cellRenderer({rowData:e}){return t("div",{class:"operators"},[t("span",{class:`gap-12 text-primary text-hoverable-primary clickable${e.files.length?"":" text-disabled"}`,onClick:()=>ee(e)},[u("下载")]),t("span",{class:"gap-12 text-primary text-hoverable-primary clickable",onClick:()=>X(e)},[u("上传")]),t(Ie,{trigger:"click",onCommand:Z},{default:()=>t("span",{class:`gap-12 text-primary text-hoverable-primary clickable${e.files.length?"":" text-disabled"}`,onClick:()=>Y(e)},[u("预览")]),dropdown:()=>{let a;return t(Ce,null,Me(a=$.value.map(k=>t(Ee,{command:k.filename},{default:()=>[k.name]})))?a:{default:()=>[a]})}}),t("span",{class:"gap-12 text-primary text-hoverable-primary clickable",onClick:()=>re(e)},[u("删除")])])}}),C=d(!1),m=d(E());function le(){C.value=!0;const e=Ve(B);e?m.value=e:m.value=E()}function L(){C.value=!1}function ne(){m.value=E()}function oe(){ne(),L()}function se(){De(B)}function ie(){xe(B,m.value,"json")===0&&O.success("暂存成功")}const F=d(""),ue=we(async e=>{n.value=await H(e)}),y=()=>{ue(F.value)};async function re(e){await he.confirm("确定要删除该量表吗？","量表删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),$e(e.id),y()}async function de(){await Be(m.value)===0?(O({message:"录入成功",type:"success"}),L(),se()):O({message:"录入失败",type:"error"}),y()}async function ce(){r.value?(await Ue(x.value,{files:b.value.map(e=>({filename:e.filename,name:e.name}))}),y()):h.value.forEach(e=>{Ae(`/api/files/download/${e.filename}`,e.name)}),v.value=!1}return(e,a)=>{const k=c("ElInput"),pe=c("ElFormItem"),me=c("ElForm"),f=c("ElButton"),j=c("ElDialog"),N=c("ElCheckbox"),fe=c("ElCheckboxGroup"),ve=c("ElTableV2"),ye=c("ElAutoResizer");return p(),_("div",Le,[t(j,{class:"i-dlg",modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=l=>C.value=l),title:"录入信息","close-on-click-modal":!1},{footer:o(()=>[t(f,{class:"opt-btn",onClick:oe},{default:o(()=>a[6]||(a[6]=[u("放弃",-1)])),_:1,__:[6]}),t(f,{type:"warning",class:"opt-btn",onClick:ie},{default:o(()=>a[7]||(a[7]=[u("暂存",-1)])),_:1,__:[7]}),t(f,{type:"primary",class:"opt-btn",onClick:de},{default:o(()=>a[8]||(a[8]=[u("提交",-1)])),_:1,__:[8]})]),default:o(()=>[R("div",je,[t(me,{model:m.value,"label-width":"auto"},{default:o(()=>[(p(!0),_(S,null,M(A(G),l=>(p(),T(pe,{label:A(z)[l],key:l},{default:o(()=>[t(k,{modelValue:m.value[l],"onUpdate:modelValue":D=>m.value[l]=D},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["model"])])]),_:1},8,["modelValue"]),t(j,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=l=>v.value=l),title:J.value,"close-on-click-modal":!1},{footer:o(()=>[t(f,{class:"opt-btn",onClick:ae},{default:o(()=>a[10]||(a[10]=[u("放弃",-1)])),_:1,__:[10]}),t(f,{type:"primary",class:"opt-btn",disabled:W.value,onClick:ce},{default:o(()=>[u(P(K.value),1)]),_:1},8,["disabled"])]),default:o(()=>[r.value?(p(),T(_e,{key:0,files:b.value,"onUpdate:files":a[1]||(a[1]=l=>b.value=l),"input-mode":"","only-upload":""},null,8,["files"])):(p(),_(S,{key:1},[t(N,{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=l=>U.value=l)},{default:o(()=>a[9]||(a[9]=[u("全选",-1)])),_:1,__:[9]},8,["modelValue"]),t(fe,{class:"download-group",modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=l=>w.value=l)},{default:o(()=>[(p(!0),_(S,null,M(g.value,l=>(p(),T(N,{key:l.filename,value:l.filename,label:l.name},{default:o(()=>[u(P(l.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])],64))]),_:1},8,["modelValue","title"]),R("div",Ne,[t(k,{modelValue:F.value,"onUpdate:modelValue":a[5]||(a[5]=l=>F.value=l),placeholder:"输入需要搜索的关键字",type:"search",onChange:y,onClear:y},{append:o(()=>[t(f,{class:"search-enter",onClick:y},{default:o(()=>a[11]||(a[11]=[u("搜索",-1)])),_:1,__:[11]})]),_:1},8,["modelValue"]),t(f,{class:"record-btn",type:"primary",onClick:le},{default:o(()=>a[12]||(a[12]=[u("录入",-1)])),_:1,__:[12]})]),n.value?(p(),_("div",Re,[t(ye,null,{default:o(({width:l,height:D})=>[t(ve,{class:"inventories-table__inner",columns:A(te),data:n.value,width:l,height:D},null,8,["columns","data","width","height"])]),_:1})])):ke("",!0)])}}}),ze=q(Pe,[["__scopeId","data-v-d915cd54"]]),Ge={class:"card"},He=Q({__name:"QaList",setup(s){return(n,i)=>(p(),_("div",Ge,[t(ze)]))}}),Ze=q(He,[["__scopeId","data-v-3d0ce6ad"]]);export{Ze as default};
