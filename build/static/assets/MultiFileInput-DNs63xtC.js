import{d as j,r as q,c as A,w as x,b as f,i as r,e as o,f as v,s as g,A as V,g as n,j as k,v as h,C as _,K as y,F as M,H as L,y as R,t as z,I as m,a3 as w,a4 as H,a5 as K,a6 as O,P as G,E as U}from"./index-BR5oj7Uf.js";import{g as J,a as Q,d as W}from"./utils-BW_ZrKIj.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"multi-file-input"},Z={class:"interactors"},ee={class:"uploaded-files"},ae={key:0,class:"check-position"},te={class:"info"},le={class:"check"},oe=j({__name:"MultiFileInput",props:{inputMode:{type:Boolean},hasDownload:{type:Boolean},onlyUpload:{type:Boolean},files:{}},emits:["update:files"],setup($,{emit:B}){const c=$,S=B,l=q([]);function b(e){window.open(`/preview?filename=${encodeURIComponent(e.filename)}&type=${J(e.filename)}`)}function D(e,t){U({message:`${e}上传失败${t?`, 原因：${t}`:""}`,type:"error"})}function I(e){U({message:`${e.name}上传成功`,type:"success"})}async function P(e){const{file:t}=e,s=new FormData;s.append("file",t);const i={name:t.name,filename:Q(),checked:!1,fileState:"on-upload"};l.value.push(i);const d=l.value.length-1,u=await G("/api/files/upload",{method:"POST",data:s,onUploadProgress(a){const p=a&&a.total?Math.round(a.loaded/a.total*100):0;l.value[d].percentage=p}}).catch(a=>a.response);if(u?.data?.success){const{file:a}=u.data;l.value[d].filename=a.filename,l.value[d].fileState="on-cloud",I(i)}else if(u?.data){const{message:a}=u.data;l.value.splice(d,1),D(t.name,a)}}const C=A({get(){return l.value.length?l.value.every(e=>!!e.checked):!1},set(e){l.value.forEach(t=>t.checked=e)}});function E(e){W(`/api/files/download/${e.filename}`,e.name)}function N(){l.value.filter(e=>!!e.checked).forEach(e=>{E(e)})}async function F(e){const s=[e].flat().map(i=>i.filename);l.value=l.value.filter(i=>!s.includes(i.filename))}function T(){const e=l.value.filter(t=>!!t.checked);F(e)}return x(()=>c.files,e=>{e&&(l.value=e)},{immediate:!0}),x(l,e=>{S("update:files",e)}),(e,t)=>{const s=g("ElButton"),i=g("ElUpload"),d=g("ElCheckbox"),u=g("ElProgress");return r(),f("div",Y,[o(i,{accept:".jpg,.png,.pdf,.docx,.xlsx",class:V(["upload-comp",{"input-mode":c.inputMode}]),"file-list":l.value,multiple:"","http-request":P},{trigger:n(()=>[k(o(s,{type:"primary"},{default:n(()=>t[3]||(t[3]=[_("上传文件",-1)])),_:1,__:[3]},512),[[h,c.inputMode]])]),file:n(()=>t[4]||(t[4]=[v("div",null,null,-1)])),default:n(()=>[v("div",Z,[k(o(s,{type:"danger",onClick:N},{default:n(()=>t[1]||(t[1]=[_("下载选中文件",-1)])),_:1,__:[1]},512),[[h,c.hasDownload]]),k(o(s,{type:"danger",onClick:T},{default:n(()=>t[2]||(t[2]=[_("删除选中文件",-1)])),_:1,__:[2]},512),[[h,c.inputMode]])])]),_:1},8,["class","file-list"]),v("div",ee,[l.value.length>1?(r(),f("div",ae,[o(d,{class:"check-all",modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=a=>C.value=a)},{default:n(()=>t[5]||(t[5]=[_("全选",-1)])),_:1,__:[5]},8,["modelValue"])])):y("",!0),(r(!0),f(M,null,L(l.value,a=>(r(),f("div",{class:"uploaded-item",key:a.filename},[v("div",te,[v("div",le,[o(d,{modelValue:a.checked,"onUpdate:modelValue":p=>a.checked=p,title:a.name},{default:n(()=>[_(z(a.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","title"])]),e.onlyUpload?y("",!0):(r(),f(M,{key:0},[o(m(w),{class:"uploaded-item-operator clickable",title:"下载",onClick:p=>E(a)},{default:n(()=>[o(m(H))]),_:2},1032,["onClick"]),o(m(w),{class:"uploaded-item-operator clickable",title:"预览",onClick:p=>b(a)},{default:n(()=>[o(m(K))]),_:2},1032,["onClick"])],64)),o(m(w),{class:"uploaded-item-operator clickable",title:"删除",onClick:p=>F(a)},{default:n(()=>[o(m(O))]),_:2},1032,["onClick"])]),a.fileState==="on-upload"&&c.inputMode?(r(),R(u,{key:0,class:V(["progress",{"beyond-half":a.percentage?a.percentage>50:!1,"is-complete":a.percentage===100}]),percentage:a.percentage||0},null,8,["class","percentage"])):y("",!0)]))),128))])])}}}),de=X(oe,[["__scopeId","data-v-0ee0b378"]]);export{de as M};
