import{d as q,r as z,c as L,w as x,a as f,o as r,f as o,b as v,h as g,n as V,g as n,e as h,v as k,m as _,C as y,F as $,z as R,p as j,t as A,u as m,$ as w,a0 as J,a1 as O,a2 as G,J as H,E as M}from"./index-BQnCW9fW.js";import{g as K,a as Q,d as W}from"./utils-DdpY_R0b.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"multi-file-input"},Z={class:"interactors"},ee={class:"uploaded-files"},ae={key:0,class:"check-position"},te={class:"info"},le={class:"check"},oe=q({__name:"MultiFileInput",props:{inputMode:{type:Boolean},hasDownload:{type:Boolean},onlyUpload:{type:Boolean},files:{}},emits:["update:files"],setup(U,{emit:B}){const c=U,S=B,l=z([]);function b(e){window.open(`/preview?filename=${encodeURIComponent(e.filename)}&type=${K(e.filename)}`)}function D(e,t){M({message:`${e}上传失败${t?`, 原因：${t}`:""}`,type:"error"})}function I(e){M({message:`${e.name}上传成功`,type:"success"})}async function P(e){const{file:t}=e,s=new FormData;s.append("file",t);const d={name:t.name,filename:Q(),checked:!1,fileState:"on-upload"};l.value.push(d);const i=l.value.length-1,u=await H("/api/files/upload",{method:"POST",data:s,onUploadProgress(a){const p=a&&a.total?Math.round(a.loaded/a.total*100):0;l.value[i].percentage=p}}).catch(a=>a.response);if(u?.data?.success){const{file:a}=u.data;l.value[i].filename=a.filename,l.value[i].fileState="on-cloud",I(d)}else if(u?.data){const{message:a}=u.data;l.value.splice(i,1),D(t.name,a)}}const C=L({get(){return l.value.length?l.value.every(e=>!!e.checked):!1},set(e){l.value.forEach(t=>t.checked=e)}});function E(e){W(`/api/files/download/${e.filename}`,e.name)}function N(){l.value.filter(e=>!!e.checked).forEach(e=>{E(e)})}async function F(e){const s=[e].flat().map(d=>d.filename);l.value=l.value.filter(d=>!s.includes(d.filename))}function T(){const e=l.value.filter(t=>!!t.checked);F(e)}return x(()=>c.files,e=>{e&&(l.value=e)},{immediate:!0}),x(l,e=>{S("update:files",e)}),(e,t)=>{const s=g("ElButton"),d=g("ElUpload"),i=g("ElCheckbox"),u=g("ElProgress");return r(),f("div",Y,[o(d,{accept:".jpg,.png,.pdf,.docx,.xlsx",class:V(["upload-comp",{"input-mode":c.inputMode}]),"file-list":l.value,multiple:"","http-request":P},{trigger:n(()=>[h(o(s,{type:"primary"},{default:n(()=>t[3]||(t[3]=[_("上传文件",-1)])),_:1,__:[3]},512),[[k,c.inputMode]])]),file:n(()=>t[4]||(t[4]=[v("div",null,null,-1)])),default:n(()=>[v("div",Z,[h(o(s,{type:"danger",onClick:N},{default:n(()=>t[1]||(t[1]=[_("下载选中文件",-1)])),_:1,__:[1]},512),[[k,c.hasDownload]]),h(o(s,{type:"danger",onClick:T},{default:n(()=>t[2]||(t[2]=[_("删除选中文件",-1)])),_:1,__:[2]},512),[[k,c.inputMode]])])]),_:1},8,["class","file-list"]),v("div",ee,[l.value.length>1?(r(),f("div",ae,[o(i,{class:"check-all",modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=a=>C.value=a)},{default:n(()=>t[5]||(t[5]=[_("全选",-1)])),_:1,__:[5]},8,["modelValue"])])):y("",!0),(r(!0),f($,null,R(l.value,a=>(r(),f("div",{class:"uploaded-item",key:a.filename},[v("div",te,[v("div",le,[o(i,{modelValue:a.checked,"onUpdate:modelValue":p=>a.checked=p,title:a.name},{default:n(()=>[_(A(a.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","title"])]),e.onlyUpload?y("",!0):(r(),f($,{key:0},[o(m(w),{class:"uploaded-item-operator clickable",title:"下载",onClick:p=>E(a)},{default:n(()=>[o(m(J))]),_:2},1032,["onClick"]),o(m(w),{class:"uploaded-item-operator clickable",title:"预览",onClick:p=>b(a)},{default:n(()=>[o(m(O))]),_:2},1032,["onClick"])],64)),o(m(w),{class:"uploaded-item-operator clickable",title:"删除",onClick:p=>F(a)},{default:n(()=>[o(m(G))]),_:2},1032,["onClick"])]),a.fileState==="on-upload"&&c.inputMode?(r(),j(u,{key:0,class:V(["progress",{"beyond-half":a.percentage?a.percentage>50:!1,"is-complete":a.percentage===100}]),percentage:a.percentage||0},null,8,["class","percentage"])):y("",!0)]))),128))])])}}}),ie=X(oe,[["__scopeId","data-v-0ee0b378"]]);export{ie as M};
